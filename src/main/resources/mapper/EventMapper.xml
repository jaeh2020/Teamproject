<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="amdn.anywhere.mapper.EventMapper">
	<resultMap type="Event" id="eventResultMap">
		<result property="eventCode" column="event_code" />
		<result property="eventName" column="event_name" />
		<result property="eventImg" column="event_img" />
		<result property="eventBanner" column="event_banner_img" />
		<result property="eventStr" column="start_time" />
		<result property="eventFin" column="end_time" />
		<result property="eventDetail" column="detail" />
		<result property="stateCode" column="state_code" />
		<result property="regTime" column="reg_time" />
		<result property="adminId" column="admin_id" />
		<result property="stateName" column="state_name" />
	</resultMap>
	
	<update id="finishEvent" parameterType="String">
		UPDATE tb_event_list
			SET 
				state_code= 'state_event_end'
		WHERE event_code = #{eventCode}
	</update>
	
	<select id="getEventList" parameterType="map" resultMap="eventResultMap">
		SELECT 
			e.event_code
			, e.event_name
			, e.event_img
			, e.event_banner_img
			, e.start_time
			, e.end_time
			, e.detail
			, e.state_code
			, e.reg_time
			, e.admin_id
			, t.state_name
		FROM tb_event_list AS e
			LEFT JOIN 
			tb_statement AS t
			ON e.state_code = t.state_code		
		<where>
			<if test="stateCode != null">
				state_code = #{stateCode}
			</if>
			<if test="eventCode != null">
				event_code = #{eventCode}
			</if>
		</where>
	</select>
</mapper>