<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/default}">

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
	
<!-- css -->
<style type= "text/css">
	.card h1{
		text-align: center;
		padding: 10px;
	}
	.join{
		display:inline-block;
		margin: 0;
		padding: 0;
	}
	.join li{
		float:left; 
		margin: 0 35px 0 35px;
	}
	.col-md-4{
		margin-top: 100px;
		margin-bottom: 80px;
	}
	.list{
		display: block;
		margin-top: 40px;
		text-align: center;
	}
	.join li p span{
		display: block;
   		width: 24px;
    	margin: 0 auto 10px;
    	padding: 30px 0 3px;
    	border-bottom: 1px solid #999;
    	color: #505050;
	}
	li .on{
		color: #4B088A;
		font-weight: bold;
	}
	.form-group div{
		border: 1px solid #000;
	}
	.form-group .sub{
		display: block;
		font-weight: bold;
		margin-top: 20px;
	}
	#foodMainList{
		margin: 20px;
		
	}
	.form-button .btn {
		display : inline-block;
		width : 70px;
		text-align: center;
		margin-left: 20px;
	}
	.form-button{
		text-align: center;
	}
</style>
</th:block>


<!-- contents layout:fragment 정의 -->
<th:block layout:fragment="customContents">
	<div class="card card-outline-primary">
		<h1>회원가입</h1>
	
		<!-- 회원가입 안내 -->
		<div class="row list">
			<ol class="join">
		           <li><p><span>01</span>회원유형선택</p></li>
		           <li><p><span>02</span>정보입력</p></li>
		           <li><p class="on"><span>03</span>추가정보입력</p></li>
		           <li><p><span>04</span>가입완료</p></li>
		    </ol>
		</div>
		
		<!-- 회원가입 내용 -->		
		<div class="unix-login">
            <div class="container-fluid">
               	<div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="login-content">
                            <div class="login-form">
                                <h4>추가 정보 입력</h4>
                                <form method="post" onload="getId()">
                                	<!-- 앞에서 입력한 아이디값 hidden으로 가져오기 -->
                                    <input type="hidden" name="userId" id="userId">
                                    <input type="hidden" name="msCode" value="ms_bronze">
                                    <input type="hidden" name="userOrderTotal" th:value="0">
                                    <input type="hidden" name="userPoint" th:value="1000">
                                    <input type="hidden" name="userEvaluator" th:value="n">
                                    <input type="hidden" name="reportScore" th:value="0">
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                	<input type="hidden" name="userLikeCode" id="userLikeCode">
                                	<input type="hidden" name="likeId" id="likeId">
                                    <div class="form-group">
	                                    <label class="sub">선호하는 음식 </label><label>( ※ 최대 3개까지만 선택 가능합니다.)</label> 
	                                    <div>
	                                   		<label id="foodMainList" th:each="l : ${foodMainList}">                                  		
	                                   			<input type="checkbox" name="like" th:value="${l.mainCateName}">
	                                   				[[${l.mainCateName}]]
	                                   		</label>
	                                    </div>		
	                                    <label class="sub">비선호하는 음식</label><label>( ※ 최대 3개까지만 선택 가능합니다.)</label> 
	                                    <div>
	                                   		<label id="foodMainList" th:each="l : ${foodMainList}">                                  		
	                                   			<input type="checkbox" name="unlike" th:value="${l.mainCateName}">
	                                   				[[${l.mainCateName}]]
	                                   		</label>
	                                    </div>		
                                    </div>
                                    <div class="form-button">
	                                  	<a th:href="@{/member/addMember02}" >
		                                    <button class="btn btn-inverse btn-flat m-b-30 m-t-30">이전</button>
	                                    </a>
	                                    <a th:href="@{/member/addMember05}">
		                                    <button type="submit" class="btn btn-success btn-flat m-b-30 m-t-30">다음</button>
	                                    </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
	</div>                  
</th:block>

<th:block layout:fragment="customJsLib">
	<script type="text/javascript">
		$(function(){
			//3개 이상 선택 시 경고창
			$('input:checkbox[name=like]').on('click', function(){				
				var cnt = $('input:checkbox[name=like]:checked').length;
				if(cnt > 3){
					$(this).prop("checked", false);
					alert("3개까지만 선택이 가능합니다.");
				}				
			});
			$('input:checkbox[name=unlike]').on('click', function(){		
				var cnt = $('input:checkbox[name=unlike]:checked').length;
				if(cnt > 3){
					$(this).prop("checked", false);
					alert("3개까지만 선택이 가능합니다.");
				}							
			});
			//체크 된 값 ajax
			$('.btn-success').on('click', function(){
				var userLikeCode = $("#userLikeCode").val();
				var likeId = $("#likeId").val();
				console.log(userLikeCode,likeId)
				//선호도
				var likeArr = [];
				$('input:checkbox[name=like]').each(function() {
		     		if(this.checked){//checked 처리된 항목의 값
		     			likeArr.push(this.value);
		      		}
				});
				//비선호도
				var unlikeArr = [];
				$('input:checkbox[name=unlike]').each(function() {
		     		if(this.checked){//checked 처리된 항목의 값
		     			unlikeArr.push(this.value);
		      		}
				});		
				//ajax
				var allData = {"userLikeCode":userLikeCode, "likeId":likeId, "likeArr":likeArr, "unlikeArr":unlikeArr}
				console.log(allData,'allData')
				
				  var request = $.ajax({
				  url: "/userLike", //요청 주소
				  method: "GET", //요청 방식
				  data: allData, //전달 할 파라미터
				  dataType: "html" //받아 올 포맷방식
				});
				//응답이 완료 되었을 경우 실행
				request.done(function( data ) {
				  console.log(data,"data");
				});
				request.fail(function(request,status,error){
			        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
			    });
				
			});
			
			//앞에서 입력한 아이디 가져와서 입력
			var inputMemberId = localStorage.getItem("inputId");
			$(document).ready(function(){
				$('#userId').val(inputMemberId);
				$('#likeId').val(inputMemberId);
			});			
		});		
	</script> 	
</th:block>
</body>
</html>