<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/default}">

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
	
<!-- css -->
<style type= "text/css">
	.btn{
		margin : 5px;
		color: #505050;
		background-color: #50508C;
		color: #fff;
		width: 100px;
	}
    #memberBiz td{
    	cursor: pointer;
    }
    p{
    	margin: 0;
    	text-align: end;
    }
</style>
</th:block>


<!-- contents layout:fragment 정의 -->
<th:block layout:fragment="customContents">

	
<div class="row">
	<input type="hidden" id="SID" th:value="${session.SID}">
		<div class="col-lg-12 ">
			<div class="card card-outline-primary">
	            <div class="card-header">
	                <h4 class="m-b-0 text-white">소상공인 승인 목록</h4>
	            </div>
	            <div class="card-body">
	            <div class="table-responsive m-t-40">
	            <p>코드를 클릭해 승인 여부를 선택해주세요.</p>
                	<table id="myTable" class="table table-bordered table-striped">
                    	<thead>
                            <tr>
                                <th>코드</th>
                                <th>소상공인 아이디</th>
                                <th>사업자 번호</th>
                                <th>소상공인 확인서</th>
                                <th>승인자 아이디</th>
                                <th>승인 요청 일시</th>
                                <th>승인 상태</th>
                                <th>승인 완료 일시</th>
                            </tr>
                        </thead>
						<tbody th:id="memberBiz">
		                    <tr th:each="l : ${memberBizList}">
		                    	<td th:text="${l.bizCode}" th:id="${l.bizCode}" class="btn btn-pink modiSelect"></td>
		                    	<td th:text="${l.memberId}"></td> 
		                    	<td th:text="${l.bizNum}"></td> 
		                    	<td th:text="${l.bizFileAtt}"></td> 
		                    	<td th:text="${l.confirmId}"></td> 
		                    	<td th:text="${l.bizReTime}"></td> 
		                    	<td th:text="${l.statement.stateName}"></td> 
		                    	<td th:text="${l.bizCompTime}"></td>
		                    </tr>
	               		</tbody>
	            	</table>
	        	</div>
			</div>
		</div>
	</div>
</div>
</th:block>


<th:block layout:fragment="customJsLib">
	<script th:src="@{/js/lib/sweetalert/sweetalert.min.js}"></script>
	<script th:src="@{/js/lib/datatables/datatables.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.flash.min.js}"></script>
    <script th:src="@{/js/lib/datatables/datatables-init.js}"></script>
	<script type="text/javascript">
		$(function(){
		 	$('.modiSelect').on('click',function(){		 		
		 		var bizCode = $(this).attr("id");
		 		sessionStorage.setItem("bizCode", bizCode);

				swal({
			            title: "승인 하시겠습니까?",
			            text: "승인 후에는 수정이 불가합니다.",
			            type: "info",
			            showCancelButton: true,
			            confirmButtonColor: "#A0CF8F",
			            confirmButtonText: "승인완료",
			            cancelButtonText: "승인거절",
			            closeOnConfirm: true,
			            closeOnCancel: true
			        },
			        //승인 눌렀을 때
			        function(isConfirm){
			            if (isConfirm) {
			            	var memberId = $('#SID').val();
			            	var bizCode = sessionStorage.getItem("bizCode");
							var state = "state_confirm_com";
				            
				            var request = $.ajax({
				    			  url: "/modifyBizConfirm", //요청 주소
				    			  method: "GET", //요청 방식
				    			  data: {"memberId" : memberId, "bizCode" : bizCode, "state":state}, //전달 할 파라미터
				    			  dataType: "html" //받아 올 포맷방식
			  				});
				          //응답이 완료 되었을 경우 실행
							request.done(function( data ) {
							  console.log(data,"data");
							  location.reload();
							});
				          	//응답 실패
							request.fail(function(request,status,error){
						        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
						    });
			            }
			            else {
			            	var memberId = $('#SID').val();
			            	var bizCode = sessionStorage.getItem("bizCode");
							var state = "state_confirm_rej";
				            
				            var request = $.ajax({
				    			  url: "/modifyBizConfirm", //요청 주소
				    			  method: "GET", //요청 방식
				    			  data: {"memberId" : memberId, "bizCode" : bizCode, "state":state}, //전달 할 파라미터
				    			  dataType: "html" //받아 올 포맷방식
			  				});
				          //응답이 완료 되었을 경우 실행
							request.done(function( data ) {
							  console.log(data,"data");
							  location.reload();
							});
				          	//응답 실패
							request.fail(function(request,status,error){
						        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
						    });
			            }
			        }); 	
			}); 
			
		})
	</script>
</th:block>
</html>