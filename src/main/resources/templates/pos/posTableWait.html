<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/default}">

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>


<style type= "text/css">
	tbody tr td{
		color: #505050;
	}
	.btn-primary{
		display : block;
		float : left;
		color: #fff;
		margin: 5px;
	}
</style>


</th:block>

<th:block layout:fragment="customJs">

	<script th:src="@{/js/lib/datatables/datatables.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.flash.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.html5.min.js}"></script>
    <script th:src="@{/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js}"></script>
    <script th:src="@{/js/lib/datatables/datatables-init.js}"></script>
    
</th:block>

<!-- contents layout:fragment 정의 -->
<th:block layout:fragment="customContents">

	<div class="row justify-content-center">
			<div class="card">
				<button type="button" class="btn btn-danger" disabled="">웨이팅 현황</button>
				<table id="" class="table table-bordered table-striped">
		                  <thead>
		                      <tr>
		                      	<th>매장코드</th>
								<th>사용중인 테이블</th>
								<th>사용가능 테이블</th>
								<th>현재 대기 인원</th>
		                      </tr>
		                  </thead>
						<tbody>
						
							<tr>
								<td th:text="${waiting.storeCode}"></td>
								<td th:text="${waiting.stoUseTab}"></td>
								<td th:text="${waiting.stoEmpTab}"></td>
								<td th:text="${waiting.waitNum}"></td>
							</tr>
						</tbody>
		        </table>
			</div>
		</div>
	
	<div class="row">
		<div class="col-lg-8">
			<div class="card">
				<button type="button" class="btn btn-info" disabled="">웨이팅대기인원</button>
				<table id="myTable" class="table table-bordered table-striped">
		                  <thead>
		                  	<tr>
		                      	<th>매장코드</th>
								<th>예약/주문코드</th>
								<th>예약대기 등록일시</th>
								<th>대기 상태</th>
								<th>입장완료<br>
								<small class="text-danger">입장완료 : </small> <small> 입장대기 > 주문완료 </small>
								</th>
								<th>입장완료 일시</th>
		                      </tr>
		                  </thead>
						<tbody>
							<tr th:each="s : ${standbyList}">
								<td th:text="${s.storeCode}" class="storeCode"></td>
								<td th:text="${s.bookCode}" class="bookCode"></td>
								<td th:text="${s.waitTime}"></td>
								<td th:text="${s.statement.stateName}" class="waitStateName"></td>
								<td>
									<button type="button" class="waitConBtn btn btn-dark btn-sm m-b-10 m-l-5">
										<i class="ti-check-box"> 입장완료 </i>
									</button>
								</td>
								<td th:text="${s.waitCompTime}"></td>
						</tbody>
		        </table>
			</div>
		</div>
		
		<div class="col-lg-4">
			<div class="card">
				<button type="button" class="btn btn-info" disabled="">테이블 현황</button>
				<table id="myTable" class="table table-bordered table-striped">
		                  <thead>
		                      <tr>
								<th>매장 코드</th>
								<th>테이블 코드</th>
								<th>테이블 번호</th>
								<th>테이블 상태</th>
								<th>테이블 상태 변경</th>
		                      </tr>
		                  </thead>
						<tbody>
							<tr th:each="p : ${posTableList}">
								<td th:text="${p.storeCode}" class="storeCode"></td>
								<td th:text="${p.storeTableCode}" class="storeTableCode"></td>
								<td th:text="${p.tableNum}"></td>
								<td th:text="${p.statement.stateName}" class="nowState"></td>
								<td>
									<select class="tableStateName">
										<option value="없">: : 상태 선택 : :</option>
										<th:block th:each="p : ${posStateList}">
										<option th:value="${p.stateName}"> 
										[[${p.stateName}]] 
										</option>
									</select>
								</td>
		                 	</tr>
						</tbody>
		        </table>
			</div>
		</div>
	</div>

</th:block>					
					
<!--Custom JavaScript -->
<th:block layout:fragment="customJsLib">
    
    <script type="text/javascript">
    
    
 	//웨이팅 입장완료 클릭시
	$(function(){
		$('.waitConBtn').on("click", function(){
			var bookCode = $(this).parent().parent().find('.bookCode').text();
			var storeCode = $(this).parent().parent().find('.storeCode').text();
			var waitStateName = $(this).parent().parent().find('.waitStateName').text();
			
			if(waitStateName == '주문완료'){
				alert('이미 주문이 완료된 건 입니다.');
				return false
				
			}else if(waitStateName == '결제완료'){
				alert('결제가 완료된 주문건은 상태변경이 불가합니다.');
				return false
				
			}else{
				if (confirm('입장처리하시겠습니까?')) {
					alert('입장처리가 완료되었습니다. \n주문POS로 이동하여 테이블을 지정해주세요.');
					location.href = "/pos/posWaitChangeState?bookCode="+ bookCode + "&state=입장완료&storeCode=" + storeCode;
			    }
			}
		});
	});
 	
 	
	//테이블상태 select 선택시
	$(function(){
		$('.tableStateName').on("change", function(){
			var storeTableCode = $(this).parent().parent().find('.storeTableCode').text();
			var tableStateName = $(this).parent().parent().find('.tableStateName').val();
			var storeCode = $(this).parent().parent().find('.storeCode').text();
			var nowState = $(this).parent().parent().find('.nowState').text();
			

			if(tableStateName == nowState){
				alert('이미 ' + nowState + ' 상태입니다');
				return false;
			}else if(tableStateName == "없"){
				alert('상태를 선택해주세요.');
			}else{
				alert('테이블 상태가 변경되었습니다.');
				location.href = "/pos/posTableUpdate?storeTableCode="+ storeTableCode + "&state=테이블상태변경&tableStateName=" + tableStateName + "&storeCode=" + storeCode;
			}
		});
	});
    
    
   
	</script>
   
</th:block>
</body>
</html>