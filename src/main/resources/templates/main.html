<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/default}">

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
	
	
<!-- css -->
<style type= "text/css">

	.btn-pink{
		background-color:transparent;
		font-family: 'Gowun Batang', serif;
	}
	
	tr,td{
		padding:10px;
	}
	
	.card-header{
		font-family: 'Gowun Batang', serif;
	}
	.btn-link{
		background-color:transparent;
		font-family: 'Gowun Batang', serif;
		font-color: black;
		font-size: 14px;
		padding-bottom: 1px;
	}
	.storeList{
		height:1500px;
		overflow:auto;
	}
	.storeList::-webkit-scrollbar { 
		width: 15px; /*스크롤바의 너비*/ 
	} 
	.storeList::-webkit-scrollbar-thumb { 
		background-color: #eeeeee; /*스크롤바의 색상*/ 
	} 
	
	.storeList::-webkit-scrollbar-track { 
		background-color: white; /*스크롤바 트랙 색상*/ 
	}
	.storeList::-webkit-scrollbar-button {
		background-color: #dddddd;
	}
    .slick-slide {
    margin:0 20px;
	}


	.slick-prev:hover:before,
	.slick-next:hover:before {
	    color: #7e7e7e;
	}
	
	.slick-prev,
	.slick-next {
	    color: #7e7e7e;
	}

 

	
</style>
	
	
</th:block>

<!-- contents layout:fragment 정의 -->
<th:block layout:fragment="customContents">
	
	
	<form th:action = "@{/}" method="get" id="searchForm">
	<input type="hidden" th:value="${session.SLEVEL}" name="level">
		<!-- 주소검색 start -->
		<div class="row justify-content-center">
			<div class="col-lg-12">
				<div class="card">
					<div class="form-group" style="margin-bottom: 0px;">
							<span class="badge badge-dark">
							<i class="ti-info-alt"> 아래 주소검색 입력란을 클릭하여 주소를 검색 후, 카테고리를 클릭하면 해당 매장 리스트가 검색됩니다.</i>
							</span>
							<div class="input-group input-group-flat">
								<input type="text" id="address_kakao" class="form-control" name="placeAddress" placeholder="건물명, 도로명 또는 지번으로 검색">
								<input type="hidden" id="seach_place" class="form-control" name="placeInput" placeholder="건물명, 도로명 또는 지번으로 검색">
							</div>
					
					<!-- 어떤매장을검색해드릴까요 이미지-->
					</div>
					<div class="card" style="background-image: url('images/main/addresswhere.png'); width: 100%; height: 0; padding-top: calc(212 / 1382 * 100%); background-repeat:no-repeat; background-size: cover; background-position: center;">
					</div>
				</div>
			</div>
		</div>
		<!-- 주소검색 end -->
		
		
	<!-- 슬라이드 -->
	<div class="row justify-content-center">
		<div class="col-sm-6">
         		<div id="slider-div">
           		<div class="eventBtn card" OnClick="location.href='/event/eventList'"
								  style="background-image: url('images/main/eventing.png'); 
								  width: 100%; height: 0; padding-top: calc(500 / 500 * 100%);
								  background-repeat:no-repeat; background-size: cover; background-position: center;
								  cursor:pointer;">
				</div>
         			<div class="card" onClick="likeBtn()"
								  style="background-image: url('images/main/keyword.png'); 
								  width: 100%; height: 0; padding-top: calc(500 / 500 * 100%); 
								  background-repeat:no-repeat; background-size: cover; background-position: center;
								  cursor:pointer;">
				</div>
          			<div class="pointBtn card"
								  onClick="pointBtn()"
								  style="background-image: url('images/main/point.png'); 
								  width: 100%; height: 0; padding-top: calc(500 / 500 * 100%); 
								  background-repeat:no-repeat; background-size: cover; background-position: center;
								  cursor:pointer;">
				</div>
        		</div>
   		</div>
    
    <!-- 실시간검색 -->
    <div class="col-sm-3">
			<div class="card">
				<div class="input-group input-group-flat">
					<input type="text" class="searchKey form-control" name="searchKey" placeholder="메뉴 or 키워드 검색" >
					<button class="searchLiveBtn btn btn-dark btn-outline ti-search" type="submit"></button>
				</div>
				
				<div class="card-header">
				<h6 style="text-align: center;">
					<i class="fa ti-timer f-s-20"></i>
					<strong>실시간 인기 검색어</strong>
					<i class="fa ti-timer f-s-20"></i>
					<br>
					<small>최근 업데이트 시간 : </small>
					<small th:text="${searchKeyword.searchUpdateTime}"></small>
				</h6>
				</div>
				
				<table>
					<tbody>
						<tr style="margin: 5px;">
							<td>
							<button class="btn btn-pink btn-outline f-s-15" disabled> 1 </button>
							</td>
							<td th:text="${searchKeyword.searchRank1}"></td>
						</tr>
						<tr>
							<td>
							<button class="btn btn-pink btn-outline f-s-15" disabled> 2 </button>
							</td>
							<td th:text="${searchKeyword.searchRank2}"></td>
						</tr>
						<tr>
							<td>
							<button class="btn btn-pink btn-outline f-s-15" disabled> 3 </button>
							</td>
							<td th:text="${searchKeyword.searchRank3}"></td>
						</tr>
					</tbody>
				</table>
				
			</div>
		</div>
	</div>
    
    
    

		<!-- 슬라이드 -->
	
		<!-- start menu cate -->
		
		<div class="row">
			<div class="col-3">
				<div class="card">
					<div class="card-body">
						<div class="row justify-content-between">
							<div class="col-lg-12">
								<div class="card-content">
									<span class="badge badge-danger" style="height: 25px; padding-top: 8px;">
									<i class="ti-angle-down"> 카테고리 </i>
									</span>
	                                	
	                                	<ul>
		                                    <th:block th:if="${#lists.size(mainCate) > 0}" th:each="c : ${mainCate}">
		                                    <li class="list-group-item">
		                                    	 <i class="ti-quote-left"></i>
		                                    	 <button name="mainCateCode" type="button" class="mainCateBtn btn btn-pink" id="mainCateBtn"
		                                    	  		 th:text="${c.mainCateName}" 
														 th:data-mainCateCode="${c.mainCateCode}"
														 th:data-mainCateName="${c.mainCateName}">
												 </button>
		                                	</li>
		                                   	</th:block>
		                                </ul>
								</div>
							
							</div>
						</div>
					</div>
				</div>
			</div>
		
	 	<!-- end menu cate -->
		
		
		
		<!-- start store info -->
			<div class="storeList col-9">
				<div class="card">
					<div class="card-body">
						<div class="row justify-content-between">
						
							<!-- start 상점목록 -->
							<th:block th:if="${#lists.size(mainList) > 0}" th:each="l : ${mainList}">
									<div class="col-lg-4">
										<div class="card-content">
												<div class="card">
													<div class="card-header text-sm-center">
															
													<!-- start ajax -->
													<button type="button" class="btn btn-danger btn sweet-wrong storeInfo" 
													th:text="${l.storeName}" 
													th:value="${l.storeName}"
													>
													</button>
																									
													</div>
													<div class="card-body">
														<div class="mx-auto d-block">
															
															<!-- 주소,전화번호 -->
															<div class="location text-sm-center">
																	<i class="fa fa-map-marker"></i>
																	<button type="button" class="btn btn-link btn-sm" th:text="${l.storeLocation}" disabled="disabled">주소 </button>
															</div>
															<div class="location text-sm-center">
																	<i class="fa fa-phone"></i>
																	<button type="button" class="btn btn-link btn-sm" th:text="${l.storePhone}" disabled="disabled">주소 </button>
															</div>
															
																<!-- 리뷰 버튼 -->
															<div class="location text-sm-center">
																	<a th:href="@{/review/reviewConfirm(storeName=${l.storeName})}" class="btn btn-outline-warning btn-xs"> 
																	<i class="fa fa-lightbulb-o"></i> 리뷰 확인 
																	</a>
															</div>
																
														<hr>
														
															<div class="card-text text-sm-center">
																<i class="ti-user" style="color: pink;"></i><p>
																<h6> 현재 대기인원은 </h6>
																<h6 class="text-sm-center mt-2 mb-1" th:text="${l.waiting.waitNum + ' 명입니다'}">대기인원</h6>
															</div>
															
														</div>
														
														<hr>
														
														<div class="card-text text-sm-center">
															<a th:href="@{/book/addBookMember(storeName=${l.storeName})}">
															<button type="button" class="btn btn-outline-danger btn-sm bookBtn">예약/주문하기</button>
															</a>
														</div>
														
													</div>
												</div>
											</div>
										</div>
									
							</th:block>
							
							<th:block th:if="${#lists.size(mainList) == 0}">
									<div class="col-lg-12">
										<div class="card-content">
												<div class="card">
													<div class="card-header text-sm-center">
													해당되는 매장이 없습니다.
													</div>
												</div>	
										</div>
									</div>
							</th:block>						
							<!-- start 상점목록 -->
							
							
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	<!-- end store info -->


	


</th:block>

<th:block layout:fragment="customJsLib">
	<script th:src="@{/js/lib/owl-carousel/owl.carousel.min.js}"></script>
    <script th:src="@{/js/lib/owl-carousel/owl.carousel-init.js}"></script>
    
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c96f24708bcaeb6b92031a20b7e4b518&libraries=services"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
  
  	<!-- Slick 불러오기 -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.min.css">
	
    <script type="text/javascript">

   
	
	/* 카테고리 버튼 유효성검사 */
	$(function(){
		$('.mainCateBtn').click(function(){
			var plaInp = $('[name=placeInput]');
			
			//유효성검사
			if(plaInp.val().trim() == ''){
				alert('주소를 먼저 입력 후 카테고리를 선택해주세요.');
				return false;
			}
			var mainCateCode = $(this).attr('data-mainCateCode');
			var mainCateName = $(this).attr('data-mainCateName');
			console.log(mainCateCode)
			$('#searchForm').append($('<input/>', {type: 'hidden', name: 'mainCateCode', value:mainCateCode }));
			$('.searchKey').val(mainCateName);
			$('#searchForm').submit();
		});
	});
	
	
	/* 실시간 검색 버튼 유효성검사 후 데이터 쌓기 */
	$(function(){
		$('.searchLiveBtn').click(function(){
			var plaInp = $('[name=placeInput]');
			var searchKey = $(this).parent().find('.searchKey').val();
			
			//유효성검사
			if(plaInp.val().trim() == ''){
				alert('주소를 먼저 입력 후 검색해주세요.');
				return false;
			}
			location.href = "/searchTotal?searchKey="+ searchKey;
			$('#searchForm').submit();
		});
	});
	
	
	/* 카카오 주소검색 api */
	
    window.onload = function(){
        document.getElementById("address_kakao").addEventListener("click", function(){ //주소입력칸을 클릭하면
            //카카오 지도 발생
            new daum.Postcode({
                oncomplete: function(data) { //선택시 입력값 세팅
                	console.log(data.address)
                    document.getElementById("address_kakao").value = data.address; // 주소 넣기
                    document.getElementById("seach_place").value = data.sigungu; // 주소 넣기
                }
            }).open();
        });
    }
    
	
	
	/* 스윗얼랏 ajax */				
	
	    $(function(){
	    	
			$('.storeInfo').click(function(){
				
				var stName = $(this).val();		
				var request =  $.ajax({
					  url: "/storeList", //요청 주소
					  method: "GET", //요청 방식
					  data: { storeName : stName }, // input name->cateCode,  value->stName
					  dataType: "json" //받아올 포맷방식
				});	
				request.done(function(data){
					
					console.log(data);
					console.log(data.storeName, data.storePhone, data.storeHoliday, data.storeLocation, data.storeTime);
					
					var htmml= '';
					
					htmml += '<br><span class="ti-comments-smiley"></span> ' + '<text style="font-family: Jua, sans-serif; font-size:40px">' + data.storeName + '</text>';
					htmml += '<br><br> <text class="text-info" style="font-family: Jua, sans-serif;"> 주소 : </text>' + '<text style="font-family: Jua, sans-serif;">' + data.storeLocation + '</text>';
					htmml += '<br> <text class="text-info" style="font-family: Jua, sans-serif;"> 전화번호 : </text>' + '<text style="font-family: Jua, sans-serif;">' + data.storePhone + '</text>';
					htmml += '<br> <text class="text-info" style="font-family: Jua, sans-serif;"> 영업시간 : </text>' + '<text style="font-family: Jua, sans-serif;">' + data.storeTime + '</text>';
					htmml += '<br> <text class="text-danger" style="font-family: Jua, sans-serif;"> 휴일 : </text>' + '<text style="font-family: Jua, sans-serif;">' + data.storeHoliday + '</text>';
									
					Swal.fire(htmml);
				
				});
				request.fail(function( jqXHR, textStatus){
					 alert( "Request failed: " + textStatus );
				});
			});
		});
	
	
	
	/* 이벤트검색 유효성검사 */
	function likeBtn() {
		var level = $('[name=level]').val();
		var plaInp = $('[name=placeInput]').val().trim();
		
		console.log(plaInp);
		
			if(level == 'level_admin'){
				alert('접근권한이 없습니다');
				return false
			}else if(level == 'level_biz'){
				alert('접근권한이 없습니다');
				return false
			}else if(level == ''){
				alert('로그인 후 이용해주세요');
				return false
			}
				if(plaInp == ''){
					alert('정확한 추천검색을 위해 주소를 입력하신 후 배너를 클릭해주세요.');
					return false
				}
				location.href = "/search/likeSearch?plaInp=" + plaInp;
	};
	
	
	
	/* 회원가입홍보 배너 유효성검사 */
	function pointBtn() {
		var level = $('[name=level]').val();
		
		console.log(level);
		
			if(level != ''){
				alert('이미 가입이 되어있는 회원입니다.');
				return false
			}
			location.href = "/member/addMember01";
	};
	
	
	$(function(){
		$('#slider-div').slick({
			 slide: 'div',        //슬라이드 되어야 할 태그 ex) div, li 
             infinite : true,     //무한 반복 옵션     
             slidesToShow : 2,        // 한 화면에 보여질 컨텐츠 개수
             slidesToScroll : 1,        //스크롤 한번에 움직일 컨텐츠 개수
             speed : 100,     // 다음 버튼 누르고 다음 화면 뜨는데까지 걸리는 시간(ms)
             arrows : true,         // 옆으로 이동하는 화살표 표시 여부
             dots : true,         // 스크롤바 아래 점으로 페이지네이션 여부
             autoplay : true,            // 자동 스크롤 사용 여부
             autoplaySpeed : 1500,         // 자동 스크롤 시 다음으로 넘어가는데 걸리는 시간 (ms)
             pauseOnHover : true,        // 슬라이드 이동    시 마우스 호버하면 슬라이더 멈추게 설정
             vertical : false,        // 세로 방향 슬라이드 옵션
             prevArrow : "<button type='button' class='slick-prev'>Previous</button>",        // 이전 화살표 모양 설정
             nextArrow : "<button type='button' class='slick-next'>Next</button>",        // 다음 화살표 모양 설정


             dotsClass : "slick-dots",     //아래 나오는 페이지네이션(점) css class 지정
             draggable : true,     //드래그 가능 여부 
             
             responsive: [ // 반응형 웹 구현 옵션
                 {  
                     breakpoint: 300, //화면 사이즈 960px
                     settings: {
                         //위에 옵션이 디폴트 , 여기에 추가하면 그걸로 변경
                         slidesToShow:3 
                     } 
                 },
                 { 
                     breakpoint: 300, //화면 사이즈 768px
                     settings: {    
                         //위에 옵션이 디폴트 , 여기에 추가하면 그걸로 변경
                         slidesToShow:2 
                     } 
                 }
             ]

        });
      })
       
    </script>
	
    
</th:block>
</html>