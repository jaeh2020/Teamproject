<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/default}">
<th:block layout:fragment="customCss">
	<style type="text/css">
		.right{
			float: right;
		}
		.card{
			width: 600px;  
		}
	</style>
</th:block>
<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
</th:block>
<!-- contents layout:fragment 정의 -->
<th:block layout:fragment="customContents">
 		
	  <div class="row justify-content-center">
	      <div class="col-lg-6">
	          <div class="card">
	              <div class="card-body">
	                  <div class="form-validation">
	                      <form class="form-valide" id="recruitApplyForm" th:action="@{/taster/recruitApplyProcess}" method="post">
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label" for="storeCode">요청매장 <span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
	                                  <select class="form-control" id="storeCode" name="storeCode">
	                                      <option value=""> : : : 매장 목록  : : : </option>
	                                      <option th:each="s : ${storeList}" th:text="${s.storeName}" th:value="${s.storeCode}"></option>
	                                  </select>
	                              </div>
	                          </div>
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label" for="menuCode">평가 메뉴 <span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
	                                  <select class="form-control" id="menuCode" name="menuCode">
	                                      <option value=""> : : : 메뉴 목록  : : : </option>
	                                  </select>
	                              	<label class="css-control css-control-primary css-checkbox right" for="newMenuCheck">
                                          <span class="text-muted m-b-15 f-s-12">등록되지 않은 신메뉴일 경우 체크</span>
                                          <input type="checkbox" class="css-control-input" id="newMenuCheck" name="menuCode">
	                                </label>
								</div>
	                          </div>
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label" for="recruitTitle">모집 공고 제목 <span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
										<input type="text" class="form-control" id="recruitTitle" name="recruitTitle" placeholder="공고명을 입력하세요..">
										<label class="css-control css-control-primary css-checkbox right" for="makeRTitle">
											<span class="text-muted m-b-15 f-s-12">자동완성</span>
											<input type="checkbox" class="css-control-input" id="makeRTitle">
		                                </label>
	                              </div> 
	                          </div>
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label" for="surveyTitle">설문조사 제목 <span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
	                                  <input type="text" class="form-control" id="surveyTitle" name="surveyTitle" placeholder="설문조사 제목을 입력하세요..">
	                              	  <label class="css-control css-control-primary css-checkbox right" for="makeSTitle">
											<span class="text-muted m-b-15 f-s-12">자동완성</span>
											<input type="checkbox" class="css-control-input" id="makeSTitle">
		                               </label>
	                              </div>
	                          </div>
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label" for="val-checkbox">모집 연령대 <span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
	                              	<label class="css-control css-control-primary css-checkbox" for="age10">
	                                  	<input type="checkbox" class="css-control-input" id="age10" name="ageCodeList" value="age_10">
	                                      <span class="css-control-indicator"></span> 10대
	                                  </label>
	                                  <label class="css-control css-control-primary css-checkbox" for="age20">
	                                  	<input type="checkbox" class="css-control-input" id="age20" name="ageCodeList" value="age_20">
	                                      <span class="css-control-indicator"></span> 20대
	                                  </label>
	                                  <label class="css-control css-control-primary css-checkbox" for="age30">
	                                  	<input type="checkbox" class="css-control-input" id="age30" name="ageCodeList" value="age_30">
	                                      <span class="css-control-indicator"></span> 30대
	                                  </label>
	                                  <label class="css-control css-control-primary css-checkbox" for="age40">
	                                  	<input type="checkbox" class="css-control-input" id="age40" name="ageCodeList" value="age_40">
	                                      <span class="css-control-indicator"></span> 40대
	                                  </label> 
	                                  <label class="css-control css-control-primary css-checkbox" for="age50">
	                                  	<input type="checkbox" class="css-control-input" id="age50" name="ageCodeList" value="age_50">
	                                      <span class="css-control-indicator"></span> 50대 이상
	                                  </label>
	                                   <label class="css-control css-control-primary css-checkbox" for="allAge">
	                                  	<input type="checkbox" class="css-control-input" id="allAge" name="ageCodeList" value="age_all">
	                                      <span class="css-control-indicator"></span> 모든 연령대
	                                  </label>
	                              </div>
	                          </div>
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label" for="recruitNumTotal">모집 인원 <span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
	                                  <input type="text" class="form-control" id="recruitNumTotal" name="recruitNumTotal" >
	                              </div>
	                          </div>
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label">모집 종료일<span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
	                                  <input type="date" class="form-control" name="recruitFinTime" placeholder="dd/mm/yyyy">
	                              </div>
	                        		</div>
	                          <div class="form-group row">
	                              <label class="col-lg-4 col-form-label" >설문 항목 <span class="text-danger">*</span></label>
	                              <div class="col-lg-7">
	                              	<input type="checkbox" class="css-control-input"  name="cateList" id="selectAllCate" value="all">
	                                <span class="css-control-indicator"></span> 전체선택
	                              	<th:block th:each="q :${qCateList}">
	                               		<label class="css-control css-control-primary css-checkbox" >
	                                   		<input type="checkbox" class="css-control-input"  name="cateList" th:value="${q.cateCode}">
	                                        <span class="css-control-indicator"></span> [[${q.cateName}]]
	                                    </label>
	                                  </th:block>        
	                               </div>
	                          </div>     
	                          <div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-website">분석 요청 항목 <span class="text-danger">*</span><p><code class="m-b-14 f-s-11">설문항목을 먼저 선택해주세요.</code></p></label>
									<div class="col-lg-7">
										<label class="css-control css-control-primary css-checkbox specialCheck">

	                                		<input type="checkbox" class="css-control-input" name="specialCateList" id="notSelectSpecial" value="noSpecial">
	                                      	<span class="css-control-indicator"></span> 선택안함
		                                </label>
										<th:block th:each="q :${qCateList}">
		                                	<label class="css-control css-control-primary css-checkbox specialCheck">

		                                		<input type="checkbox" class="css-control-input" name="specialCateList" th:value="${q.cateCode}" disabled="disabled">

		                                      	<span class="css-control-indicator"></span> [[${q.cateName}]]
		                                  	</label>
		                              	</th:block>
	                               </div>
	                          </div>
	                          <div class="form-group row">
	                              <div class="col-lg-8 ml-auto">
	                                  <button type="submit" class="btn btn-primary" id="submitBtn" >Submit</button>
	                              </div>
	                          </div>
	                      </form>
	                  </div>
	              </div>
	          </div>
	      </div>
	  </div>
</th:block>
<!-- End PAge Content -->
			
 <!--Custom JavaScript -->
<th:block layout:fragment="customJsLib">
	<script type="text/javascript">
	
	/*
	1. 메뉴체크/신메뉴 체크 validation 진행 필요.
	*/
	
			var form = $('#recruitApplyForm');
			var selectStore = $('#storeCode');
			var selectMenu = $('#menuCode');
			var newMenuCheck = $('#newMenuCheck');
			var recruitTitle = $('#recruitTitle');
			var surveyTitle = $('#surveyTitle');
			var ageCodeList = $('[name=ageCodeList]');
			var selectAllCate = $('#selectAllCate');
			var surveyCateList = $('[name=cateList]');
			var specialCateList = $('[name=specialCateList]');
		

			//연령대 선택 - 모든 연령대 이벤트
			
			$(function(){
				$('#allAge').on("change", function(){
					
					for(var i = 0; i < ageCodeList.length; i++){
						
						if($(this).is(":checked") == true){
							
							if(i == 5) break;
							ageCodeList.eq(i).attr('disabled','true');
						
						}else{
							
							ageCodeList.eq(i).removeAttr('disabled');
						}
					}
				});
			});
			
			
			$(function(){
				$('#notSelectSpecial').on("click", function(){
					
					var checked = $(this).prop("checked");
					
					if(checked){
						for(var i = 1; i < specialCateList.length; i++){
							specialCateList.eq(i).attr('disabled','true');
						}
					}else{
						
						for(var i = 0 ; i < surveyCateList.length; i++){
							 if(surveyCateList.eq(i).prop("checked")){
								 for(var j = 0; j < specialCateList.length; j++){
									 if(specialCateList.eq(j).val() == surveyCateList.eq(i).val()){
										 specialCateList.eq(j).removeAttr('disabled');
									 }
								 }
							  }
						 }
					}
				});
			});
			
			
			
			//설문항목 체크박스 이벤트
			
			$(function(){
				surveyCateList.on("change", function(){
					
					var checked = $(this).prop("checked");
					
					if($(this).val() == 'all'){
						//설문항목 전체체크 이벤트
						if(selectAllCate.prop("checked")){
							surveyCateList.prop("checked", true);
							specialCateList.prop("checked", false);
							specialCateList.removeAttr('disabled');
						}else{
							surveyCateList.prop("checked", false);
							specialCateList.prop("checked", false);
							specialCateList.attr('disabled','true');
						}
					}else{
						selectAllCate.prop("checked", false);
						for(var i = 0; i < specialCateList.length; i++){
							if(specialCateList.eq(0).prop("checked")){
								break;
							}else{
								if($(this).val() == specialCateList.eq(i).attr('value')){
									if(checked){	
										specialCateList.eq(i).removeAttr('disabled');
									}else{
										specialCateList.eq(i).attr('disabled','true');
									}
								}
							}
						}
						
					}
				});	
			});
			
			$(function(){
				selectMenu.on("click", function(){
					if(selectStore.val() == null || selectStore.val() == ''){
						alert('매장을 먼저 선택해주세요.');
					}
				});
			});
			
			//신메뉴 체크박스 이벤트
			
			$(function(){
				newMenuCheck.on("change", function(){
					if(newMenuCheck.prop("checked")){
						selectMenu.attr('disabled', 'true');			
					}else {
						selectMenu.removeAttr('disabled');
					}						
				});
			});
	
			//메뉴 목록 가져오기
			
			$(function(){
				selectStore.on("change", function(){
					
					var selectedStoreCode = $(this).val();
					
					if(selectedStoreCode != ''){
						
						var request = $.ajax({
							url: "/taster/menuList", //요청 주소
							method: "GET", //요청 방식
							data: { storeCode : selectedStoreCode },
							dataType: "json" //받아올 포맷방식
						});
						
						request.done(function(data){
							var option = '<option value=""> : : : 메뉴 목록  : : : </option>';
							var length = data.length;
							
							if(length == 0) option += '<option> 등록된 메뉴가 없습니다. </option>';
							else if(length > 0){
								for(var i=0; i < length ; i++){
									option += '<option value ="' + data[i].menuCode +'">' + data[i].menuName + '</option>';
								}
							}
							selectMenu.html(option);
						});
						request.fail(function(jqXHR, textStatus){
							alert( "Request failed: " + textStatus );
						});
					}
				});		
			});
			
			function selectChckFn(){
				if(selectStore.val() == null || selectStore.val() == ''){
					alert('매장을 먼저 선택해주세요.');
					return false;
				}
				if(selectMenu.val() == null || selectMenu.val() == ''){
					alert('메뉴를 먼저 선택해주세요.');
					return false;
				}
				return true;
			}
			
			var date = new Date();
			var year = date.getFullYear();
			
			$(function(){
				$('#makeRTitle').on("click", function(){
					var result = selectChckFn();
					if(result){
						if($(this).prop("checked")){
							var storeName = $('#storeCode option:selected').text();		
							var newRTitle =  year + '년도'+' [' + storeName +'] 에서 평가단을 모집합니다.';
							recruitTitle.val(newRTitle);
							recruitTitle.attr('readonly', true);	
						}else if($(this).prop("checked") == false){
							recruitTitle.val('');
							recruitTitle.removeAttr('readonly');
						}
					}else{
						return false;
					}
				});
			});
			$(function(){
				$('#makeSTitle').on("click", function(){
					var result = selectChckFn();
					if(result){
						if($(this).prop("checked")){
							var storeName = $('#storeCode option:selected').text();
							var menuName =  $('#menuCode option:selected').text();
							var newSTitle =  year + '년도'+' [' + storeName +' - ' + menuName + '] 설문조사';
							surveyTitle.val(newSTitle);
							surveyTitle.attr('readonly', true);	
						}else if($(this).prop("checked") == false){
							surveyTitle.val('');
							surveyTitle.removeAttr('readonly');
						}						
					}else{
						return false;
					}
				});
			});
	</script>
	<script th:src="@{/js/lib/form-validation/jquery.validate.min.js}"></script>
    <script th:src="@{/js/lib/form-validation/jquery.validate-init.js}"></script>
</th:block>
    
    

</html>