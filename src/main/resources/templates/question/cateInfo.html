<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/default}">

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
</th:block>

<!-- contents layout:fragment 정의 -->
<th:block layout:fragment="customContents">
 		
	   <div class="row">
		  	<div class="col-lg-6">
	            <div class="card">
	                <div class="card-title" >
	                    <h4 >설문조사 항목</h4> 
	                </div>
	                <div class="card-body">
	                    <div class="table-responsive">
	                        <table class="table table-hover ">
	                            <thead>
	                                <tr>
	                                    <th>번호</th>
	                                    <th>항목코드</th>
	                                    <th>항목명</th>
	                                    <th>항목수정</th>
	                                    <th>항목삭제</th>
	                                    <th>문항보기</th>
	                                </tr>
	                            </thead>
	                            <tbody>
	                                <tr th:each="l : ${cateList}">
	                                    <td th:text="${lStat.count}"></td>
	                                    <td class="cateName" th:text="${l.cateCode}"></td>
	                                    <td class="cateName" th:text="${l.cateName}"></td>
	                                    <td>
	                                    	<button type="button" class="btn btn-primary btn-rounded btn-addon m-b-10 m-l-5"><a th:href="@{/addQCate}"><i class="ti-pencil"></i></a></button>
	                                    </td>
	                                    <td>
	                                    	<button type="button" class="btn btn-danger btn-rounded btn-addon m-b-10 m-l-5"><i class="ti-minus"></i></button>
	                                   	</td>
	                                    <td th:id="${l.cateCode}">
	                                    	<button type="button" class="viewQ btn btn-dark btn-outline btn-rounded m-b-10 m-l-5"><i class="ti-search"></i></button>
	                                    </td>
	                                </tr>
	                            </tbody>
	                        </table>
	                    </div>
	                    <form method="post" th:action="@{/addQCate}">  
	                    	 <p>새 항목을 추가하려면 <code>항목코드</code>와 <code>항목명</code>을 입력하세요</p>            
	                         <div class="form-group">
	                               <div class="input-group input-group-flat">
	                                   <input type="text" placeholder="항목코드를 입력하세요" name="newCateCode" class="form-control input-focus">
	                                   <input type="text" placeholder="항목명을 입력하세요" name="newCateName" class="form-control input-focus">
	                                   <span class="input-group-btn"><button class="btn btn-primary btn-group-right " type="button" id="addCateBtn"><i class="ti-plus"></i>항목 추가</button></span>
	                               </div>
	                           </div>
                         </form>                    
	                </div>
	            </div>
	            <!-- /# card -->
	        </div>
	        <div class="col-lg-6">
		        <div class="card">
		        	<div class="card-title">
	                    <h4>문항 목록</h4> 
		                    <div class="card-body">
			                     <button type="button" class=" btn btn-default btn-rounded btn-addon m-b-10 m-l-5">
				                		<a th:href="@{/updateQuestions}"><i class="ti-pencil"></i>수정하기</a>
				                </button>
		                     	 <div class="table-responsive">
		                       		 <table class="table table-hover ">
		                            	<thead>
		                                	 	<th>번호</th>
			                                    <th>문항 내용</th>
		                                </thead>
		                                <tbody id="questionList">
		                                </tbody>
		                              </table>
		                         </div>
		                    </div>
	                 </div>
		        </div>
	        </div>
        </div>
</th:block>


<th:block layout:fragment="customJsLib">
	<script type="text/javascript">
	
	/*문항 목록 가져오기*/	
		
		$(function(){
				$('.viewQ').click(function(){
				var tdId = this.parentElement.id;
				
				var request =  $.ajax({
					  url: "/questionList", //요청 주소
					  method: "GET", //요청 방식
					  data: { cateCode : tdId },
					  dataType: "json" //받아올 포맷방식
					});	
				request.done(function(data){
					var tbody= '';
					var length = data.length;
					for(var i= 0; i<length; i++){
						tbody += '<tr><td>' + (i+1) + '</td><td>' + data[i].qContent + '</td></tr>';  
					}
					$('#questionList').html(tbody);	
				});
				request.fail(function( jqXHR, textStatus){
					 alert( "Request failed: " + textStatus );
				});
			});
		});
	/*항목 추가하기*/
	$(function(){
		$('#addCateBtn').click(function(){
			
			var newCode = $('[name=newCateCode]');
			var newName = $('[name=newCateName]');
			console.log(newCode,newName);
			//유효성검사
			if(newCode.val().trim() ==''){
				alert('항목코드를 입력해주세요');
				newCode.focus();
				return;
			}
			if(newName.val().trim() ==''){
				alert('항목명을 입력해주세요');
				newName.focus();
				return;
			}
		$('form').submit();
			
			
		});
	});
	

	</script>

</th:block>
</html>